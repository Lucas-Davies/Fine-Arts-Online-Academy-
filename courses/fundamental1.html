<!DOCTYPE html>
<html lang="en-AU">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <title>Fundamentals Course 1</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <style>
    :root{
      --ink:#eef3ff; --muted:rgba(238,243,255,.76); --stroke:rgba(255,255,255,.14);
      --surface:rgba(0,0,0,.46); --bg:#000; --blue:#0A84FF; --railGrey:#242a34;
      --r:16px; --pad:16px; --max:1080px;
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);
      font:16px -apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,sans-serif}

    /* Top bar */
    .nav{position:sticky;top:0;z-index:40;background:rgba(0,0,0,.68);backdrop-filter:blur(10px);
      border-bottom:1px solid var(--stroke)}
    .nav-inner{max-width:var(--max);margin:0 auto;padding:10px var(--pad);display:flex;align-items:center;gap:10px}
    .btn{appearance:none;border:1px solid var(--stroke);background:#16181f;color:var(--ink);
      padding:10px 14px;border-radius:12px;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:8px}
    .btn.primary{background:var(--blue);border-color:#0a6fe0;color:#fff}
    .pill{border:1px solid var(--stroke);background:var(--surface);border-radius:999px;padding:6px 10px}
    .spacer{flex:1}

    /* Page */
    .wrap{max-width:var(--max);margin:0 auto;padding:16px var(--pad) 64px}
    h1{font-size:1.6rem;margin:0 0 6px}
    .muted{color:var(--muted)}

    /* Lock banner */
    .banner{display:none;margin:10px 0 0;background:rgba(255,159,10,.12);border:1px solid rgba(255,159,10,.4);
      color:#ffdca6;padding:10px 12px;border-radius:12px}
    .banner.locked{display:block}

    /* Large video lightbox (Darcy-style) */
    .player{position:relative;border:1px solid var(--stroke);border-radius:16px;overflow:hidden;background:#111}
    video{display:block;width:100%;height:auto;background:#000}
    .minNote{position:absolute;right:10px;bottom:10px;background:rgba(0,0,0,.5);border:1px solid var(--stroke);
      padding:6px 10px;border-radius:999px;font-size:.85rem;display:none}
    .minimised .minNote{display:block}

    /* Edge-to-edge progress bar (blue fill) + circular milestones */
    .rail{margin:12px 0 8px;position:relative;height:8px;border-radius:999px;background:var(--railGrey);overflow:hidden}
    .rail-fill{position:absolute;left:0;top:0;bottom:0;width:0;background:var(--blue)}
    .milestones{display:flex;justify-content:space-between;gap:8px}
    .dot,.trophy{
      width:36px;height:36px;border-radius:999px;border:2px solid rgba(255,255,255,.24);
      background:rgba(255,255,255,.05);color:var(--ink);display:grid;place-items:center;
      font-weight:800;cursor:pointer;user-select:none
    }
    .dot.done{background:rgba(10,132,255,.22);border-color:rgba(10,132,255,.7)}
    .dot.current{outline:2px solid rgba(10,132,255,.9);outline-offset:2px;border-color:var(--blue)}
    .dot.locked{opacity:.55}
    .trophy{font-size:18px;border-color:rgba(255,255,255,.22)}
    .trophy.ready{background:rgba(50,215,75,.2);border-color:rgba(50,215,75,.6)}
    .dot:focus-visible,.trophy:focus-visible{outline:2px solid #7ab8ff;outline-offset:3px}

    /* Cards */
    .card{border:1px solid var(--stroke);border-radius:16px;background:var(--surface);padding:16px;margin-top:12px}
    .card h3{margin:.2rem 0 8px}

    /* Knowledge check */
    .qa{display:flex;flex-direction:column;gap:10px;margin-top:8px}
    .q{border:1px solid var(--stroke);border-radius:12px;background:rgba(255,255,255,.03);padding:10px 12px}
    .q button{appearance:none;border:none;background:transparent;color:var(--blue);
      padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:600}
    .q button:hover{filter:brightness(1.1)}
    .a{margin-top:6px;border-left:3px solid var(--blue);padding:8px 12px;border-radius:8px;background:rgba(10,132,255,.08);display:none}
    .q.revealed .a{display:block}

    /* Prev/Next row */
    .nav-row{display:flex;gap:10px;justify-content:space-between;margin-top:16px}
    .btn[disabled]{opacity:.55;cursor:not-allowed}

    /* Hidden chip container so core can trigger MutationObserver updates */
    #progressChips{display:none}
  </style>
</head>
<body>

  <!-- Top nav with Home button styled like others -->
  <header class="nav" role="banner">
    <div class="nav-inner">
      <a href="../home.html" class="btn" aria-label="Back to Home">‚Üê Home</a>
      <div id="courseTitle" class="pill" aria-live="polite">Fundamentals Course 1</div>
      <div class="spacer"></div>
      <div id="pointsPill" class="pill" aria-live="polite">Points: 0</div>
    </div>
  </header>

  <main class="wrap" role="main">
    <h1 id="moduleTitle">Loading‚Ä¶</h1>
    <p id="summary" class="muted" hidden></p>
    <div id="lockedBanner" class="banner" role="status" aria-live="polite"></div>

    <!-- Video -->
    <section id="playerWrap" class="player" aria-label="Lesson video">
      <video id="video" playsinline controls preload="metadata"></video>
      <div class="minNote">Video minimised ‚Äî scroll for activity</div>
    </section>

    <!-- Edge-to-edge progress bar + steps 1..10 + trophy -->
    <div class="rail" aria-label="Course progress">
      <div id="railFill" class="rail-fill"></div>
    </div>
    <div id="railDots" class="milestones" role="tablist" aria-label="Modules"></div>

    <!-- Summary (~300 words auto if short) -->
    <section class="card">
      <h3>Summary</h3>
      <div id="longSummary" class="muted" style="white-space:pre-wrap"></div>
    </section>

    <!-- Knowledge check -->
    <section class="card">
      <h3>Test your knowledge</h3>
      <p class="muted" style="margin-top:0">Tap <b style="color:#0A84FF">Reveal</b> on each item. Revealing all answers earns the badge for this exercise.</p>
      <div id="qaWrap" class="qa" role="list"></div>

      <div class="nav-row">
        <button id="btnPrev" class="btn" aria-label="Previous exercise">‚Üê Prev</button>
        <button id="btnNext" class="btn primary" aria-label="Next exercise">Next ‚Üí</button>
      </div>
    </section>

    <!-- Hidden element used by fundamentals-core to trigger updates -->
    <div id="progressChips" aria-hidden="true"></div>
  </main>

  <script src="../assets/fundamentals-core.js"></script>
  <script>
    /* ---------- Boot shared core ---------- */
    Fundamentals.init({
      courseId: "fundamental1",
      dataUrl: "../data/fundamental1.json"
    });

    /* ---------- Rail logic (blue fill + circular milestones + trophy) ---------- */
    const TOTAL = 10;
    const courseId = "fundamental1";
    const railFill = document.getElementById("railFill");
    const railDots = document.getElementById("railDots");

    function getProg(){ return JSON.parse(localStorage.getItem("course:"+courseId) || "{}") || {}; }
    function curIdx(){
      const n = parseInt((location.hash||"").replace("#/m/",""),10);
      return Number.isFinite(n) ? Math.max(0, Math.min(TOTAL-1,n)) : 0;
    }
    function doneCount(p){ return Math.min((p.modules||[]).filter(m=>m&&m.badge).length, TOTAL); }

    function buildRail(){
      const p = getProg();
      const cur = curIdx();

      // Blue fill up to current step (like your reference image)
      const pct = ((cur+1) / TOTAL) * 100;
      railFill.style.width = pct + "%";

      // Dots 1..10 + trophy
      railDots.innerHTML = "";
      for (let i=0;i<TOTAL;i++){
        const b = document.createElement("button");
        b.type="button"; b.className="dot"; b.textContent = i+1;
        if (p.modules?.[i]?.badge) b.classList.add("done");
        if (i===cur) b.classList.add("current");
        if (i>cur+1 && !(p.modules?.[i-1]?.badge)) b.classList.add("locked"); // visual hint
        b.setAttribute("aria-label", `Go to module ${i+1}`);
        b.onclick = ()=> location.hash = "#/m/"+i; // core handles gating/preview
        railDots.appendChild(b);
      }
      const t = document.createElement("button");
      t.type="button"; t.className="trophy"; t.textContent="üèÜ";
      const allDone = doneCount(p) >= TOTAL;
      if (allDone) t.classList.add("ready");
      t.title = "Achievements / Certificate";
      t.onclick = ()=>{
        // send to your existing certificate page (or swap to in-page achievements if you prefer)
        const title = document.getElementById('courseTitle')?.textContent || 'Course';
        location.href = `../certificate.html?courseId=${encodeURIComponent(courseId)}&courseTitle=${encodeURIComponent(title)}`;
      };
      railDots.appendChild(t);
    }

    // Rebuild on core changes and navigation
    const chips = document.getElementById("progressChips");
    const mo = new MutationObserver(()=> buildRail());
    mo.observe(chips, { childList:true, subtree:true });
    window.addEventListener("hashchange", buildRail);
    buildRail();

    /* ---------- Long summary (~300 words if needed) ---------- */
    function expandSummary(){
      const short = document.getElementById("summary")?.textContent || "";
      const target = document.getElementById("longSummary");
      const need = 300;
      if (short.split(/\s+/).length >= need){ target.textContent = short; return; }
      const filler = [
        "This session builds practical confidence through simple, repeatable actions. ",
        "You will move quickly, avoid perfectionism and focus on what the eye actually sees. ",
        "Small timed exercises help you discover rhythm, economy of mark, and control over materials. ",
        "Expect to iterate: gesture first, refine later. ",
        "Where possible, stand while you draw; it frees the shoulder and opens your line. ",
        "Keep tools visible and within reach so momentum never stalls. ",
        "Use light touch to explore placement, then commit with darker passes. ",
        "Pause occasionally to step back and compare major shapes. ",
        "Look more than you draw: the subject will tell you what to do next. ",
        "Remember that mistakes are information, not failure. ",
        "Your aim is clarity, not accuracy at all costs; remove anything that does not serve the idea. ",
        "Finally, record learnings after each pass so the next attempt starts from a higher base. "
      ].join("");
      // repeat the filler enough times to reach ~300 words
      const words = (short + " " + filler).trim().split(/\s+/);
      while (words.length < need) { words.push(...filler.split(/\s+/)); }
      target.textContent = words.slice(0, need).join(" ");
    }
    window.addEventListener("hashchange", expandSummary);
    expandSummary();
  </script>
</body>
</html>