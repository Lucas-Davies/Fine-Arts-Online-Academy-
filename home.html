<!DOCTYPE html>
<html lang="en-AU">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <title>Home</title>
  <style>
    :root{
      --bg:#000; --ink:#eef3ff; --ink-dim:#cfd3e1; --muted:rgba(238,243,255,.78); --stroke:rgba(255,255,255,.16);
      --blue:#0A84FF; --green:#32d74b; --gold:#ffd700; --silver:#c0c7d1; --red:#ff453a;
      --r:12px; --gap:12px; --maxw:1240px; --nav-h:64px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px -apple-system,BlinkMacSystemFont,"SF Pro Text","Helvetica Neue",Arial,sans-serif}
    a{color:inherit;text-decoration:none}

    .bg{position:fixed;inset:0;z-index:-1;background:#000 url("./assets/home-bg.jpg") center/cover no-repeat}

    /* Unified header */
    .nav{
      position:fixed;inset:0 0 auto; height:var(--nav-h); display:flex; align-items:center; gap:10px; padding:10px 12px;
      background:linear-gradient(180deg,rgba(0,0,0,.85),rgba(0,0,0,.25) 70%,transparent);
      -webkit-backdrop-filter:blur(10px); backdrop-filter:blur(10px); z-index:30;
    }
    /* Squarish controls */
    .ctl{display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:10px 14px; border-radius:12px; border:1px solid var(--stroke); background:rgba(0,0,0,.55);
      font-weight:800; cursor:pointer; white-space:nowrap; user-select:none}
    .ctl.blue{background:var(--blue); color:#fff; border-color:transparent}
    .ctl.green{background:var(--green); color:#000; border-color:transparent}
    .ctl.gold{background:var(--gold); color:#0f1116; border-color:transparent}
    .ctl.ghost{background:rgba(0,0,0,.45); color:var(--ink)}

    /* Tabs in header */
    .tabs{display:flex; gap:10px; align-items:center; flex:1 1 auto; overflow:hidden}
    .tab{ composes: ctl; } /* (conceptual) */
    .tab{padding:10px 14px; border-radius:12px; border:1px solid var(--stroke); background:rgba(0,0,0,.55); font-weight:800}
    .tab.is-active{background:var(--blue); color:#fff; border-color:transparent}
    /* “More” – full-screen sheet on narrow screens */
    .more{position:relative}
    .more-sheet{
      position:fixed; inset:0; display:none; background:rgba(0,0,0,.85); -webkit-backdrop-filter:blur(6px); backdrop-filter:blur(6px);
      padding:16px; z-index:60
    }
    .more.open .more-sheet{display:block}
    .more-grid{display:grid; grid-template-columns:1fr; gap:10px; max-width:540px; margin:64px auto 0}
    .more-grid .tab{display:flex; justify-content:center; font-size:18px}

    /* Avatar trigger with round cap on right */
    .avatar-wrap{position:relative; margin-left:auto}
    .avatar-btn{display:inline-flex; align-items:center; gap:10px}
    .avatar-btn .label{composes: ctl;} /* conceptual */
    .avatar-btn .label{padding:10px 14px; border-radius:12px 0 0 12px; border:1px solid var(--stroke); background:rgba(0,0,0,.55); font-weight:800}
    .avatar-btn .cap{width:36px;height:36px;border-radius:50%;border:1px solid var(--stroke); background:linear-gradient(135deg,rgba(255,255,255,.14),rgba(255,255,255,.04)); display:grid; place-items:center; font-weight:900}

    /* Avatar dropdown */
    .menu{position:absolute; right:0; top:calc(100% + 8px); width:min(92vw, 320px); display:none;
      background:#0f1116; border:1px solid var(--stroke); border-radius:14px; padding:10px; z-index:70;
      box-shadow:0 18px 48px rgba(0,0,0,.55)}
    .avatar-wrap.open .menu{display:block}
    .menu-row{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px; border-radius:10px; border:1px solid var(--stroke); background:#0b0f14}
    .menu-note{margin:6px 0 2px; color:var(--ink-dim); font-size:.86rem}

    /* Page wrapper */
    .wrap{max-width:var(--maxw); margin:0 auto; padding:calc(var(--nav-h) + 12px) 12px 72px}

    /* Heroes */
    .hero{
      position:relative; overflow:hidden; background:#000; border:1px solid var(--stroke); border-radius:16px; padding:16px; margin:12px 0; min-height:220px
    }
    .hero .title{margin:0; font-weight:900; font-size:18px; display:flex; align-items:center; gap:8px}
    .hero .meta{margin:4px 0 0; color:var(--ink-dim); font-size:.92rem}
    .hero .desc{margin:8px 0 0; color:var(--muted)}
    .cta-left{position:absolute; left:16px; bottom:16px}
    .price{position:absolute; right:12px; bottom:12px; padding:6px 10px; border-radius:10px; font-weight:900; background:rgba(0,0,0,.55); border:1px solid var(--stroke)}
    .points-bubble{position:absolute; right:12px; top:12px; padding:6px 10px; border-radius:999px; font-weight:900; background:#ffd700; color:#0f1116}
    .points-bubble[hidden]{display:none}
    .complete .title::after{content:" ✓"; color:var(--green); font-weight:900}

    /* Silver padlock (use external file added by you) */
    .padlock{width:20px;height:20px;flex:0 0 auto;vertical-align:-3px;filter:none}
    /* Weekly row / stack */
    .weekly{display:grid; gap:var(--gap)}
    @media (orientation:landscape){ .weekly{grid-template-columns:repeat(3, minmax(0,1fr))} }
    @media (max-width:680px){ .hero.course{ min-height: 264px } } /* ~20% taller on iPhone */

    /* Courses grids */
    .grid{display:grid; gap:var(--gap); margin:12px 0}
    .grid-3{grid-template-columns:repeat(3, minmax(0,1fr))}
    .tall{min-height:260px}
    @media (orientation:portrait){ .grid-3{grid-template-columns:1fr} }

    /* Buttons */
    .btn{composes: ctl;} /* conceptual */
    .btn{padding:12px 16px; border-radius:12px; font-weight:800; border:0}
    .btn.blue{background:var(--blue); color:#fff}
    .btn.green{background:var(--green); color:#000}
    .btn.gold{background:var(--gold); color:#0f1116}
    .btn.ghost{background:rgba(0,0,0,.45); color:var(--ink); border:1px solid var(--stroke)}
    .btn[disabled]{opacity:.6; cursor:not-allowed}

    .section-title{margin:12px 2px 6px; font-size:18px; font-weight:900}

    /* Hide the legacy brand block entirely */
    .brand,.logo{display:none!important}
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>

  <!-- HEADER -->
  <header class="nav" role="banner">
    <!-- Tabs in header -->
    <nav class="tabs" role="tablist" aria-label="Primary">
      <button class="tab is-active" role="tab" aria-selected="true" aria-controls="p-challenges" id="t-challenges">Challenges</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="p-courses" id="t-courses">Courses</button>
      <button class="tab" role="tab" aria-selected="false" aria-controls="p-live" id="t-live">Live</button>
      <div class="more" id="more">
        <button class="tab" id="btnMore" aria-haspopup="true" aria-expanded="false">More ▾</button>
        <div class="more-sheet" id="moreSheet">
          <div class="more-grid" id="moreGrid"></div>
          <div style="text-align:center; margin-top:14px">
            <button class="ctl ghost" id="closeMore">Close</button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Avatar (right) -->
    <div class="avatar-wrap" id="avatarWrap">
      <a href="#" class="avatar-btn" id="avatarBtn" aria-haspopup="true" aria-expanded="false">
        <span class="label">Account</span>
        <span class="cap" id="avatarCap">JG</span>
      </a>
      <div class="menu" id="avatarMenu" role="menu">
        <div class="menu-note"><strong>Account</strong></div>
        <div class="menu-row">
          <span>Subscription</span>
          <button class="ctl ghost" id="subToggle" aria-pressed="false">Off</button>
        </div>
        <div class="menu-row"><a href="#p-calendar" id="goCalendar">My Calendar</a><span>›</span></div>
        <div class="menu-row"><a href="profile.html#achievements">Achievements</a><span>›</span></div>
        <div class="menu-note"><strong>Shortcuts</strong></div>
        <div class="menu-row"><a href="profile.html#slot1">Placeholder 1</a><span>›</span></div>
        <div class="menu-row"><a href="profile.html#slot2">Placeholder 2</a><span>›</span></div>
        <div class="menu-row"><a href="profile.html#slot3">Placeholder 3</a><span>›</span></div>
      </div>
    </div>
  </header>

  <main class="wrap" role="main">
    <!-- PANELS -->
    <section class="panel" id="p-challenges" role="tabpanel" aria-labelledby="t-challenges">
      <!-- Daily -->
      <article class="hero" id="dailyHero">
        <h2 class="title">Today’s Daily Challenge</h2>
        <p class="meta"><span id="dailyDate">—</span></p>
        <p class="desc" id="dailyDesc">A fast 15–20 minute warm-up. Keep it loose, focus on big decisions.</p>
        <div class="cta-left">
          <button class="btn blue" id="btnDaily">Complete</button>
        </div>
      </article>

      <!-- Weekly (subscriber-only) -->
      <h3 class="section-title">Weekly Challenges (Subscribers)</h3>
      <div class="weekly" id="weekly"></div>
    </section>

    <section class="panel" id="p-courses" role="tabpanel" aria-labelledby="t-courses" hidden>
      <h2 class="section-title">Courses</h2>

      <h3 class="section-title">Foundations (Subscribers)</h3>
      <div class="grid grid-3">
        <article class="hero tall course" data-kind="foundation" data-id="found-setup" data-link="course-found-setup.html">
          <h3 class="title"><img class="padlock" src="padlock-premium.svg" alt="" /> Materials &amp; Setup</h3>
          <p class="meta">Prepare your space: paper, charcoal, inks, brushes, safe layout.</p>
          <p class="desc">Step-by-step setup to start drawing/painting with confidence.</p>
          <div class="cta-left"><button class="btn blue act-found">Start Course</button></div>
        </article>

        <article class="hero tall course" data-kind="foundation" data-id="found-drawing" data-link="course-found-drawing.html">
          <h3 class="title"><img class="padlock" src="padlock-premium.svg" alt="" /> Drawing</h3>
          <p class="meta">Line, tone, proportion, gesture, observation.</p>
          <p class="desc">Foundational drills to build accuracy and flow.</p>
          <div class="cta-left"><button class="btn blue act-found">Start Course</button></div>
        </article>

        <article class="hero tall course" data-kind="foundation" data-id="found-painting" data-link="course-found-painting.html">
          <h3 class="title"><img class="padlock" src="padlock-premium.svg" alt="" /> Painting</h3>
          <p class="meta">Surface prep, colour mixing, value structure, brushwork.</p>
          <p class="desc">Learn stable processes that free you to be expressive.</p>
          <div class="cta-left"><button class="btn blue act-found">Start Course</button></div>
        </article>
      </div>

      <h3 class="section-title">1-Day Intensives</h3>
      <div class="grid grid-3">
        <article class="hero tall course" data-kind="paid" data-id="1d-gesture" data-link="course-1d-gesture.html" data-redeem="0">
          <h3 class="title">Gesture Drawing</h3>
          <p class="meta">Fast, confident gesture studies.</p>
          <p class="desc">Build energy and decision-making in minutes.</p>
          <div class="cta-left"><button class="btn green act-buy">Buy</button></div>
          <div class="points-bubble" data-points="?"><span class="bp">?</span></div>
          <div class="price" data-price="$?"><span class="pr">$?</span></div>
        </article>

        <article class="hero tall course" data-kind="paid" data-id="1d-ink" data-link="course-1d-ink.html" data-redeem="0">
          <h3 class="title">Ink Essentials</h3>
          <p class="meta">Brush, pen, splash control.</p>
          <p class="desc">Harness accidents while keeping structure.</p>
          <div class="cta-left"><button class="btn green act-buy">Buy</button></div>
          <div class="points-bubble" data-points="?"><span class="bp">?</span></div>
          <div class="price" data-price="$?"><span class="pr">$?</span></div>
        </article>

        <article class="hero tall course" data-kind="paid" data-id="1d-charcoal" data-link="course-1d-charcoal.html" data-redeem="0">
          <h3 class="title">Charcoal Tonals</h3>
          <p class="meta">Structure with light/dark.</p>
          <p class="desc">Design clear value statements with charcoal.</p>
          <div class="cta-left"><button class="btn green act-buy">Buy</button></div>
          <div class="points-bubble" data-points="?"><span class="bp">?</span></div>
          <div class="price" data-price="$?"><span class="pr">$?</span></div>
        </article>
      </div>

      <h3 class="section-title">3-Day Courses</h3>
      <div class="grid grid-3">
        <article class="hero tall course" data-kind="paid" data-id="3d-portrait" data-link="course-3d-portrait.html" data-redeem="500">
          <h3 class="title">Portrait Sprint</h3>
          <p class="meta">Planes, proportions, expression.</p>
          <p class="desc">A concentrated 3-day block to level-up portraits.</p>
          <div class="cta-left"><button class="btn green act-buy">Buy</button></div>
          <div class="points-bubble" data-points="500"><span class="bp">500</span></div>
          <div class="price" data-price="$?"><span class="pr">$?</span></div>
        </article>
        <article class="hero tall course" data-kind="paid" data-id="3d-urban" data-link="course-3d-urban.html" data-redeem="500">
          <h3 class="title">Urban Sketching</h3>
          <p class="meta">Perspective on location.</p>
          <p class="desc">Speed, accuracy, and atmosphere outdoors.</p>
          <div class="cta-left"><button class="btn green act-buy">Buy</button></div>
          <div class="points-bubble" data-points="500"><span class="bp">500</span></div>
          <div class="price" data-price="$?"><span class="pr">$?</span></div>
        </article>
        <article class="hero tall course" data-kind="paid" data-id="3d-experimental" data-link="course-3d-experimental.html" data-redeem="500">
          <h3 class="title">Experimental Media</h3>
          <p class="meta">Combine mediums without fear.</p>
          <p class="desc">Push materials while keeping control.</p>
          <div class="cta-left"><button class="btn green act-buy">Buy</button></div>
          <div class="points-bubble" data-points="500"><span class="bp">500</span></div>
          <div class="price" data-price="$?"><span class="pr">$?</span></div>
        </article>
      </div>

      <h3 class="section-title">30-Day Courses</h3>
      <div class="grid grid-3">
        <article class="hero tall course" data-kind="paid" data-id="30d-draw" data-link="course-30d-draw.html" data-redeem="1500">
          <h3 class="title">Drawing Foundations</h3>
          <p class="meta">Daily habit and core skills.</p>
          <p class="desc">A month of guided practice to lock in fundamentals.</p>
          <div class="cta-left"><button class="btn green act-buy">Buy</button></div>
          <div class="points-bubble" data-points="1500"><span class="bp">1500</span></div>
          <div class="price" data-price="$?"><span class="pr">$?</span></div>
        </article>
        <article class="hero tall course" data-kind="paid" data-id="30d-paint" data-link="course-30d-paint.html" data-redeem="1500">
          <h3 class="title">Paint with Confidence</h3>
          <p class="meta">Colour, value, edges.</p>
          <p class="desc">Disciplined routines to paint with clarity.</p>
          <div class="cta-left"><button class="btn green act-buy">Buy</button></div>
          <div class="points-bubble" data-points="1500"><span class="bp">1500</span></div>
          <div class="price" data-price="$?"><span class="pr">$?</span></div>
        </article>
        <article class="hero tall course" data-kind="paid" data-id="30d-portrait" data-link="course-30d-portrait.html" data-redeem="1500">
          <h3 class="title">Expressive Portraits</h3>
          <p class="meta">Structure plus spontaneity.</p>
          <p class="desc">From armature to edge design to decisive accents.</p>
          <div class="cta-left"><button class="btn green act-buy">Buy</button></div>
          <div class="points-bubble" data-points="1500"><span class="bp">1500</span></div>
          <div class="price" data-price="$?"><span class="pr">$?</span></div>
        </article>
      </div>
    </section>

    <section class="panel" id="p-live" role="tabpanel" aria-labelledby="t-live" hidden>
      <h2 class="section-title">Live Demonstrations</h2>
      <div class="grid grid-3">
        <article class="hero tall live" data-id="live-1" data-link="live-1.html">
          <h3 class="title">Upcoming Demo #1</h3>
          <p class="meta">Bookings add gold calendar entries; completion adds ✓.</p>
          <p class="desc">Streaming link sent after purchase.</p>
          <div class="cta-left"><button class="btn green act-buy">Buy</button></div>
          <div class="points-bubble" data-points="?"><span class="bp">?</span></div>
          <div class="price" data-price="$?"><span class="pr">$?</span></div>
        </article>
        <article class="hero tall live" data-id="live-2" data-link="live-2.html">
          <h3 class="title">Upcoming Demo #2</h3>
          <p class="meta">Details to be announced.</p>
          <p class="desc">Bookings create gold entries; completion ✓.</p>
          <div class="cta-left"><button class="btn green act-buy">Buy</button></div>
          <div class="points-bubble" data-points="?"><span class="bp">?</span></div>
          <div class="price" data-price="$?"><span class="pr">$?</span></div>
        </article>
        <article class="hero tall live" data-id="live-3" data-link="live-3.html">
          <h3 class="title">Upcoming Demo #3</h3>
          <p class="meta">Details to be announced.</p>
          <p class="desc">Bookings create gold entries; completion ✓.</p>
          <div class="cta-left"><button class="btn green act-buy">Buy</button></div>
          <div class="points-bubble" data-points="?"><span class="bp">?</span></div>
          <div class="price" data-price="$?"><span class="pr">$?</span></div>
        </article>
      </div>
    </section>

    <!-- Calendar lives ONLY in avatar menu context (no header tab) -->
    <section class="panel" id="p-calendar" hidden>
      <h2 class="section-title">My Calendar</h2>
      <p class="meta">Calendar UI kept lightweight here — entries are still recorded for purchases, redemptions, and completions.</p>
      <div id="calList"></div>
    </section>
  </main>

  <!-- PURCHASE / REDEEM MODAL -->
  <div class="menu" id="buyModal" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);display:none;max-width:520px;width:92vw;z-index:90">
    <h3 id="buyTitle" style="margin-top:0">Unlock</h3>
    <p id="buyDesc">Purchase to unlock forever. You can redeem with points if available.</p>
    <div style="display:flex; gap:8px; flex-wrap:wrap">
      <button class="btn green" id="btnPay">Pay Now</button>
      <button class="btn gold" id="btnRedeem" hidden>Redeem with Points</button>
      <button class="btn ghost" id="btnCancelBuy">Cancel</button>
    </div>
    <p class="meta" id="redeemInfo" style="margin-top:8px"></p>
  </div>

  <script>
  (function(){
    'use strict';
    const $ = (s, r=document)=>r.querySelector(s);
    const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));
    const pad = n=>String(n).padStart(2,'0');
    const toISO = d=>d.toISOString().slice(0,10);
    const dayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    const fmtD_M = d=>`${pad(d.getDate())}/${pad(d.getMonth()+1)}`;

    /* Storage keys */
    const K = {
      sub:'ao_isSubscriber', points:'ao_points', purchased:'ao_purchased',
      daily:'ao_completedDailies', weekly:'ao_completedWeeklies', hist:'ao_history',
      pricing:'ao_pricing_cache'
    };
    const store = {
      get(k,f){ try{const v=localStorage.getItem(k); return v?JSON.parse(v):f}catch{return f} },
      set(k,v){ localStorage.setItem(k, JSON.stringify(v)); },
      del(k){ localStorage.removeItem(k); }
    };

    /* State */
    let isSub = !!store.get(K.sub,false);
    let points = +store.get(K.points,0);
    let purchased = store.get(K.purchased,[]);
    let dailyDone = store.get(K.daily,[]);
    let weeklyDone = store.get(K.weekly,[]); // [{id,dateISO}]
    let pricing = store.get(K.pricing,{});

    /* Header: tabs switching + “More” sheet behavior */
    const panels = { challenges:$('#p-challenges'), courses:$('#p-courses'), live:$('#p-live'), calendar:$('#p-calendar') };
    const tabBtns = [$('#t-challenges'), $('#t-courses'), $('#t-live')].filter(Boolean);
    function showPanel(id){
      Object.values(panels).forEach(p=>p && (p.hidden=true));
      (panels[id]||panels.challenges).hidden=false;
      tabBtns.forEach(b=>b.classList.toggle('is-active', ('p-'+b.id.slice(2))=== (panels[id]||{}).id ));
      window.scrollTo({top:0,behavior:'instant'});
    }
    tabBtns.forEach(b=> b.addEventListener('click', ()=> showPanel(b.id.slice(2))));
    showPanel('challenges');

    /* More overflow → full-screen on iPhone */
    const more = $('#more'), btnMore = $('#btnMore'), moreSheet = $('#moreSheet'), moreGrid = $('#moreGrid'), closeMore=$('#closeMore');
    function layoutTabs(){
      // On narrow screens, always show the “More” button; copy hidden tabs inside sheet
      const allTabs = tabBtns;
      // We try to fit: Challenges, Courses, Live; if overflow, those will be visible in sheet as well.
      // For iPhone we simply replicate all tabs in the sheet to make it easy to hit.
      moreGrid.innerHTML='';
      allTabs.forEach(tb=>{
        const clone = tb.cloneNode(true);
        clone.classList.remove('is-active');
        clone.addEventListener('click', ()=>{ showPanel(tb.id.slice(2)); toggleMore(false); });
        moreGrid.appendChild(clone);
      });
    }
    function toggleMore(open){
      more.classList.toggle('open', open);
      btnMore.setAttribute('aria-expanded', open?'true':'false');
    }
    btnMore.addEventListener('click', ()=> toggleMore(!more.classList.contains('open')));
    closeMore.addEventListener('click', ()=> toggleMore(false));
    window.addEventListener('resize', layoutTabs);
    layoutTabs();

    /* Avatar dropdown */
    const avatarWrap = $('#avatarWrap'), avatarBtn = $('#avatarBtn'), avatarMenu = $('#avatarMenu'), subToggle = $('#subToggle');
    function openAvatar(open){
      avatarWrap.classList.toggle('open', open);
      avatarBtn.setAttribute('aria-expanded', open?'true':'false');
    }
    avatarBtn.addEventListener('click', (e)=>{ e.preventDefault(); openAvatar(!avatarWrap.classList.contains('open')); });
    document.addEventListener('click', (e)=>{ if(!avatarWrap.contains(e.target)) openAvatar(false); });

    function paintSubToggle(){
      subToggle.setAttribute('aria-pressed', isSub?'true':'false');
      subToggle.textContent = isSub ? 'On' : 'Off';
    }
    subToggle.addEventListener('click', ()=>{
      isSub = !isSub; store.set(K.sub,isSub); paintSubToggle(); paintFoundations(); paintWeekly();
    });
    paintSubToggle();

    $('#goCalendar').addEventListener('click', (e)=>{ e.preventDefault(); openAvatar(false); showPanel('calendar'); renderCalendarList(); });

    /* Set daily */
    const today = new Date(); $('#dailyDate').textContent = `${dayNames[today.getDay()]} ${fmtD_M(today)}`;
    function paintDaily(){
      const done = dailyDone.includes(toISO(new Date()));
      const btn = $('#btnDaily'); const hero = $('#dailyHero');
      btn.textContent = done ? 'Undo' : 'Complete';
      btn.className = 'btn ' + (done ? 'ghost' : 'blue');
      hero.classList.toggle('complete', done);
    }
    $('#btnDaily').addEventListener('click', ()=>{
      const iso = toISO(new Date());
      const i = dailyDone.indexOf(iso);
      if(i>-1){ dailyDone.splice(i,1); }
      else { dailyDone.push(iso); points+=1; }
      store.set(K.points, points); store.set(K.daily, dailyDone);
      pushHist({type:'daily', title:'Daily Challenge'});
      paintDaily(); renderCalendarList();
    });
    paintDaily();

    /* WEEKLY set */
    const WEEKLY=[
      {id:'W01',title:'Gesture Lines',desc:'Loose lines, large arm movement.'},
      {id:'W02',title:'Negative Space',desc:'See shapes around the subject.'},
      {id:'W03',title:'Value Ladder',desc:'Five-step tonal control.'},
      {id:'W04',title:'Edges—Hard/Soft',desc:'Control transitions.'},
      {id:'W05',title:'Ink + Wash',desc:'Line then dilute wash.'},
      {id:'W06',title:'Contour & Blind',desc:'Trust the line, look more.'},
      {id:'W07',title:'Planes of the Head',desc:'Break forms into planes.'},
      {id:'W08',title:'Texture Hunt',desc:'Rubbings + drawn textures.'},
      {id:'W09',title:'Silhouette Power',desc:'Readability in outline.'},
      {id:'W10',title:'Warm/Cool Contrast',desc:'Temperature decisions.'},
      {id:'W11',title:'Mark Variety',desc:'Thick, thin, broken, dragged.'},
      {id:'W12',title:'Compositional Threes',desc:'Foreground/mid/background.'},
      {id:'W13',title:'Speed Studies',desc:'1–5 minute bursts.'},
      {id:'W14',title:'Cross-hatching',desc:'Controlled texture build.'},
      {id:'W15',title:'Ink Splashes',desc:'Directed spontaneity.'},
      {id:'W16',title:'Charcoal Tonals',desc:'Mass the shadows.'},
      {id:'W17',title:'Lost & Found Edges',desc:'Melt and sharpen selectively.'},
      {id:'W18',title:'Gesture Portrait',desc:'Energy over detail.'},
      {id:'W19',title:'Light Direction',desc:'Single source studies.'},
      {id:'W20',title:'Abstracted Forms',desc:'Simplify to shapes.'},
      {id:'W21',title:'Perspective Basics',desc:'1-point & 2-point.'},
      {id:'W22',title:'Figure Rhythm',desc:'S-curve, C-curve flow.'},
      {id:'W23',title:'Limited Palette',desc:'3 colours max.'},
      {id:'W24',title:'Big Brushes',desc:'Commit to bold passes.'},
      {id:'W25',title:'Smudge & Lift',desc:'Subtractive drawing.'},
      {id:'W26',title:'Line Hierarchy',desc:'Weight guides the eye.'},
      {id:'W27',title:'Edges with Water',desc:'Feathered dissolves.'},
      {id:'W28',title:'Thumbnails',desc:'Plan before render.'},
      {id:'W29',title:'Pattern & Repetition',desc:'Motifs unify.'},
      {id:'W30',title:'Proportion Check',desc:'Sight-size habits.'},
      {id:'W31',title:'Expressive Tools',desc:'Sticks, cards, rags.'},
      {id:'W32',title:'Colour Notes',desc:'Small patches first.'},
      {id:'W33',title:'Focal Point',desc:'Contrast and detail.'},
      {id:'W34',title:'Edges & Atmosphere',desc:'Depth via softness.'},
      {id:'W35',title:'Ink Portrait',desc:'Brush + splash accents.'},
      {id:'W36',title:'Value Composition',desc:'3-value design.'},
      {id:'W37',title:'Contour + Tone',desc:'Line then mass.'},
      {id:'W38',title:'Gesture Landscapes',desc:'Broad shapes quickly.'},
      {id:'W39',title:'Reflected Light',desc:'Turn the form.'},
      {id:'W40',title:'Textural Contrast',desc:'Smooth vs rough.'},
      {id:'W41',title:'Edges—Lost Foreground',desc:'Merge into background.'},
      {id:'W42',title:'Colour Harmony',desc:'Analogous harmony.'},
      {id:'W43',title:'Ink & Charcoal Mix',desc:'Wet over dry.'},
      {id:'W44',title:'Expressive Hands',desc:'Structure + gesture.'},
      {id:'W45',title:'Skies & Weather',desc:'Mood studies.'},
      {id:'W46',title:'Back-lighting',desc:'Rims and silhouettes.'},
      {id:'W47',title:'Fabric & Folds',desc:'Light logic.'},
      {id:'W48',title:'Architecture Lines',desc:'Plumb & level.'},
      {id:'W49',title:'Edge Priorities',desc:'Where to sharpen.'},
      {id:'W50',title:'Colour Accents',desc:'Small high-chroma hits.'},
      {id:'W51',title:'Gesture Animals',desc:'Capture movement.'},
      {id:'W52',title:'Best-of Remix',desc:'Combine 3 skills.'}
    ];
    function firstSunday(y){ const d=new Date(y,0,1); const off=(7-d.getDay())%7; const s=new Date(y,0,1+off); s.setHours(0,0,0,0); return s;}
    function weekIdx(d){ const y=d.getFullYear(), s=firstSunday(y); const diff=d-s; if(diff<0) return weekIdx(new Date(y-1,11,31)); return Math.floor(diff/(7*24*3600*1000))%52;}
    function startSunday(d){ const x=new Date(d.getFullYear(),d.getMonth(),d.getDate()); x.setDate(x.getDate()-x.getDay()); x.setHours(0,0,0,0); return x;}
    function addWeeks(d,w){ const x=new Date(d); x.setDate(x.getDate()+w*7); return x;}

    function weeklyData(){
      const base=startSunday(new Date());
      // current + previous 2
      const blocks=[0,-1,-2].map(w=>{
        const s=addWeeks(base,w); const i=weekIdx(s); const def=WEEKLY[i];
        const end=addWeeks(s,4); end.setDate(end.getDate()-1); // 4-week window, hidden from UI
        return {id:def.id, title:def.title, desc:def.desc, start:s, end, done: !!weeklyDone.find(x=>x.id===def.id)};
      });
      // sort: outstanding first by earliest end; completed last (same order rule)
      const outs = blocks.filter(b=>!b.done).sort((a,b)=>a.end-b.end);
      const done = blocks.filter(b=>b.done).sort((a,b)=>a.end-b.end);
      return outs.concat(done);
    }

    function paintWeekly(){
      const wrap=$('#weekly'); wrap.innerHTML='';
      const locked = !isSub;
      weeklyData().forEach(w=>{
        const card=document.createElement('article'); card.className='hero'; if(w.done) card.classList.add('complete');
        card.dataset.weekId=w.id;
        card.innerHTML=`
          <h3 class="title">${locked?`<img class="padlock" src="padlock-premium.svg" alt=""> `:''}${w.title}</h3>
          <p class="meta">${dayNames[w.start.getDay()]} ${fmtD_M(w.start)} → ${dayNames[w.end.getDay()]} ${fmtD_M(w.end)}</p>
          <p class="desc">${w.desc}</p>
          <div class="cta-left">
            <button class="btn ${locked?'ghost':'blue'} act-week" ${locked?'disabled':''} data-week="${w.id}">${w.done?'Restart':'Start Challenge'}</button>
          </div>`;
        wrap.appendChild(card);
      });
      $$('.act-week', wrap).forEach(b=>{
        b.addEventListener('click', ()=>{
          const id=b.dataset.week;
          if(!weeklyDone.find(x=>x.id===id)){
            weeklyDone.push({id, dateISO:toISO(new Date())}); store.set(K.weekly,weeklyDone);
            points+=10; store.set(K.points,points); pushHist({type:'weekly', title:id});
          }else{
            weeklyDone=weeklyDone.filter(x=>x.id!==id); store.set(K.weekly,weeklyDone);
          }
          paintWeekly(); renderCalendarList();
        });
      });
    }
    paintWeekly();

    /* FOUNDATIONS gate by subscription; same silver padlock as weekly */
    function paintFoundations(){
      $$('#p-courses [data-kind="foundation"]').forEach(card=>{
        const locked = !isSub;
        const lockEl = card.querySelector('.padlock');
        if(lockEl) lockEl.style.display = locked? 'inline':'none';
        const btn = card.querySelector('.act-found');
        if(locked){ btn.setAttribute('disabled',''); } else { btn.removeAttribute('disabled'); }
      });
    }
    paintFoundations();

    $$('.act-found').forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        const card=e.currentTarget.closest('.course'); if(!isSub) return;
        const link=card.dataset.link; pushHist({type:'1day-span', title:card.querySelector('.title').textContent.trim()}); window.location.href=link;
      });
    });

    /* Pricing (optional hook). If you have a pricing script, set window.PRICE_LIST = {id:{price:'$99',points:500}} */
    function loadPricing(){
      try{
        if(window.PRICE_LIST){ pricing=window.PRICE_LIST; store.set(K.pricing,pricing); }
      }catch{}
      applyPricing();
    }
    function applyPricing(){
      $$('.course, .live').forEach(card=>{
        const id=card.dataset.id; const p=pricing[id]||{};
        const priceEl=card.querySelector('.pr'); const bubble=card.querySelector('.bp'); const bubbleWrap=card.querySelector('.points-bubble');
        if(priceEl) priceEl.textContent = p.price || card.querySelector('.price')?.dataset.price || '$?';
        if(bubble){ const pts = p.points ?? +card.getAttribute('data-redeem') || '?'; bubble.textContent = pts; bubbleWrap.dataset.points=pts; }
        if(purchased.includes(id)){ unlockCard(card); }
      });
    }
    function unlockCard(card){
      // Purchased → remove price + points bubble; green “Open”
      card.querySelector('.price')?.setAttribute('hidden','');
      card.querySelector('.points-bubble')?.setAttribute('hidden','');
      const btn=card.querySelector('.act-buy'); if(btn){ btn.textContent='Open'; btn.className='btn green act-open'; }
    }
    loadPricing();

    /* Buy flow (modal with Pay or Redeem) */
    let pending=null;
    const buyModal = $('#buyModal'), btnPay=$('#btnPay'), btnRedeem=$('#btnRedeem'), btnCancelBuy=$('#btnCancelBuy'), buyTitle=$('#buyTitle'), redeemInfo=$('#redeemInfo');
    function openBuy(card){
      const id=card.dataset.id, title=card.querySelector('.title').textContent.trim(), link=card.dataset.link||'#';
      const pts = card.querySelector('.points-bubble')?.dataset.points;
      const price = card.querySelector('.pr')?.textContent||'$?';
      pending={card,id,title,link,pts,price};
      buyTitle.textContent = `Unlock “${title}”`;
      const redeemable = pts && pts!=='?' && +pts>0;
      btnRedeem.hidden = !redeemable;
      redeemInfo.textContent = redeemable ? `You can redeem for ${pts} points.` : 'This item is not redeemable with points.';
      buyModal.style.display='block';
    }
    function closeBuy(){ buyModal.style.display='none'; pending=null; }
    btnCancelBuy.addEventListener('click', closeBuy);

    // Buy buttons
    $$('.act-buy').forEach(b=> b.addEventListener('click', e=> openBuy(e.currentTarget.closest('.hero'))));
    // Open if already purchased
    document.addEventListener('click', e=>{
      if(e.target.classList.contains('act-open')){
        const card=e.target.closest('.hero'); const link=card.dataset.link||'#'; window.location.href=link;
      }
    });

    btnPay.addEventListener('click', ()=>{
      if(!pending) return;
      // Simulate purchase success; in your app, redirect to payment.html and return with success flag.
      if(!purchased.includes(pending.id)){ purchased.push(pending.id); store.set(K.purchased,purchased); }
      pushHist({type:'purchase', title:pending.title});
      unlockCard(pending.card);
      closeBuy();
      renderCalendarList();
    });

    btnRedeem.addEventListener('click', ()=>{
      if(!pending) return;
      const need = +pending.pts || 0;
      if(points < need){ alert(`You need ${need - points} more points to redeem.`); return; }
      points -= need; store.set(K.points,points);
      if(!purchased.includes(pending.id)){ purchased.push(pending.id); store.set(K.purchased,purchased); }
      pushHist({type:'redeem', title:pending.title});
      unlockCard(pending.card);
      closeBuy();
      renderCalendarList();
    });

    /* Points bubble tap → show delta */
    $$('.points-bubble').forEach(b=>{
      b.addEventListener('click', ()=>{
        const need = b.dataset.points==='?'? NaN : +b.dataset.points;
        if(isNaN(need)){ alert('Points price: unknown yet.'); return; }
        const diff = points - need;
        alert(diff>=0 ? `You have enough points. After redeeming you would have ${diff} left.` : `You need ${Math.abs(diff)} more points to redeem.`);
      });
    });

    /* History + calendar mini list */
    let history = store.get(K.hist,[]);
    function pushHist(e){
      history.unshift({ts:Date.now(), ...e});
      store.set(K.hist, history);
    }
    function renderCalendarList(){
      const list=$('#calList'); if(!list) return;
      list.innerHTML='';
      history.slice(0,80).forEach(h=>{
        const d=new Date(h.ts);
        const row=document.createElement('div');
        row.style.cssText='padding:8px 10px;border:1px solid var(--stroke);border-radius:8px;background:#0b0f14;margin:6px 0';
        row.textContent=`${pad(d.getDate())}/${pad(d.getMonth()+1)} ${pad(d.getHours())}:${pad(d.getMinutes())} • ${h.type.toUpperCase()} — ${h.title||''}`;
        list.appendChild(row);
      });
    }

    /* Keyboard/escape for modals */
    document.addEventListener('keydown', e=>{
      if(e.key==='Escape'){ if(more.classList.contains('open')) toggleMore(false); if(buyModal.style.display==='block') closeBuy(); openAvatar(false); }
    });

  })();
  </script>
<!-- ========= PATCH: header cleanup, avatar dropdown, landscape/portrait "More", clickability ========= -->
<style>
  /* Make sure nothing invisible is blocking taps/clicks */
  .overlay:not(.open),
  .popover:not(.open),
  .modal:not(.open){ pointer-events:none }
  .hero, .btn, .tab, .more-btn, .more-item, .avatar, .pill, a, button { pointer-events:auto }

  /* Remove any "Account" control in the header */
  .nav :is(.account, .btn-account, [data-role="account"]) { display:none !important }

  /* Tabs inside header: same square-ish shape (to match avatar’s left edge) */
  .nav .tab{
    border-radius:12px !important;         /* square-ish */
    padding:11px 16px !important;
    white-space:nowrap;
  }

  /* Avatar container (right end) — square-ish left, circular right */
  .pill{
    display:flex; align-items:center; gap:8px;
    padding:6px 8px 6px 12px;
    border-radius:12px 999px 999px 12px !important; /* left square-ish, right round */
    overflow:hidden;
  }
  /* Non-subscriber = SILVER; Subscriber = GOLD (your main script toggles .gold/.silver) */
  .pill.silver{ background:#c0c7d1 !important; color:#0f1116 !important; border:0 !important; }
  .pill.gold  { background:#ffd700 !important; color:#0f1116 !important; border:0 !important;
                box-shadow:0 8px 26px rgba(255,215,0,.28) }

  /* Round avatar circle anchored on the RIGHT side of the pill */
  .pill .avatar{
    order:2;
    width:36px; height:36px; min-width:36px;
    border-radius:50% !important;
    background:#0b0f14;
    border:2px solid rgba(0,0,0,.18);
    display:grid; place-items:center; font-weight:900;
  }
  /* Keep optional points compact at the left (can be empty if you prefer) */
  .pill .points-badge{ order:1; background:transparent; border:0; padding:0; font-weight:900 }

  /* Avatar dropdown */
  .avatar-wrap{ position:relative }
  .avatar-menu{
    position:absolute; right:0; top:calc(100% + 8px); z-index:60;
    display:none; width:min(92vw, 320px);
    background:#0f1116; border:1px solid var(--stroke); border-radius:14px; padding:10px;
    box-shadow:0 18px 46px rgba(0,0,0,.55);
  }
  .avatar-wrap.open .avatar-menu{ display:block }
  .menu-row{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:10px 12px; border-radius:12px; border:1px solid var(--stroke);
    background:rgba(0,0,0,.55); font-weight:800; cursor:pointer;
  }
  .menu-row a{ color:var(--ink); text-decoration:none; font-weight:800 }
  .menu-note{ margin:6px 4px 4px; color:var(--ink-dim); font-size:.86rem }

  /* “More” menu — default popover */
  .more-wrap{ position:relative }
  .more-btn{
    padding:10px 14px; border-radius:12px; border:1px solid var(--stroke);
    background:rgba(0,0,0,.55); color:var(--ink); font-weight:800; cursor:pointer;
  }
  .more-list{
    position:absolute; right:0; top:calc(100% + 6px); min-width:220px; z-index:55;
    display:none; flex-direction:column; gap:6px; padding:8px; border-radius:12px;
    background:#0f1116; border:1px solid var(--stroke); box-shadow:0 14px 36px rgba(0,0,0,.5);
  }
  .more-wrap.open .more-list{ display:flex }
  .more-item{
    padding:10px 12px; border-radius:12px; border:1px solid var(--stroke);
    background:rgba(0,0,0,.55); color:var(--ink); font-weight:800; text-align:left;
  }

  /* iPhone portrait: “More” becomes full-screen sheet for easy tapping */
  @media (max-width: 680px) and (orientation:portrait){
    .more-list.fullscreen{
      position:fixed; inset:calc(var(--nav-h) + 4px) 10px 10px 10px;
      border-radius:14px; padding:12px; gap:10px; overflow:auto;
    }
    .more-item{ padding:14px 16px; font-size:17px }
  }
</style>

<script>
(() => {
  const $  = (s,r=document)=>r.querySelector(s);
  const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));

  /* ---------- 1) Remove any "Account" button ----------- */
  $$('.nav :is(.account, .btn-account, [data-role="account"])').forEach(n=> n.remove());

  /* ---------- 2) Ensure the avatar is at the far right --- */
  const header = $('.nav');
  const pill   = $('#pillUser');
  if (header && pill) { pill.parentElement.style.marginLeft = 'auto'; }

  /* ---------- 3) Build avatar dropdown ------------------ */
  if (pill && !pill.closest('.avatar-wrap')){
    const wrap = document.createElement('div');
    wrap.className = 'avatar-wrap';
    pill.parentNode.insertBefore(wrap, pill);
    wrap.appendChild(pill);

    // Dropdown content (subscription toggle moved here)
    const menu = document.createElement('div');
    menu.className = 'avatar-menu';
    menu.innerHTML = `
      <div class="menu-note"><strong>Account</strong></div>
      <div class="menu-row" id="menuSubRow">
        <span>Subscription</span>
        <button class="toggle" id="menuToggleSub" aria-pressed="false">Off</button>
      </div>
      <div class="menu-row"><a href="profile.html#achievements">Achievements</a><span>›</span></div>
      <div class="menu-row"><a href="#tab-courses" id="menuCourses">Courses</a><span>›</span></div>
      <div class="menu-row"><a href="#tab-live" id="menuLive">Live</a><span>›</span></div>
      <div class="menu-note"><strong>Shortcuts</strong></div>
      <div class="menu-row"><a href="profile.html#slot1">Placeholder 1</a><span>›</span></div>
      <div class="menu-row"><a href="profile.html#slot2">Placeholder 2</a><span>›</span></div>
      <div class="menu-row"><a href="profile.html#slot3">Placeholder 3</a><span>›</span></div>
    `;
    wrap.appendChild(menu);

    // Open/close
    const avatarBtn = $('#avatarLink');
    avatarBtn?.addEventListener('click', (e)=>{ e.preventDefault(); wrap.classList.toggle('open'); });
    document.addEventListener('click', (e)=>{ if(!wrap.contains(e.target)) wrap.classList.remove('open'); });

    // Sync the subscription toggle with the app’s main toggle state
    const hdrToggle  = $('#toggleSub');
    const menuToggle = $('#menuToggleSub');
    const sync = ()=>{
      const on = hdrToggle?.getAttribute('aria-pressed') === 'true';
      menuToggle.textContent = on ? 'On' : 'Off';
      menuToggle.setAttribute('aria-pressed', on ? 'true' : 'false');
      // gold/silver avatar background is already handled by your app paintTopChrome()
    };
    sync();
    hdrToggle?.addEventListener('click', sync);
    menuToggle?.addEventListener('click', ()=>{ hdrToggle?.click(); sync(); });
  }

  /* ---------- 4) Tabs overflow: hide “More” in landscape, use only when needed in portrait ---- */
  const midTabs  = header?.querySelector('.nav__tabs') || header; // where tabs live
  const moreWrap = header?.querySelector('.more-wrap');
  const moreBtn  = header?.querySelector('#btnMore');
  const moreList = header?.querySelector('#moreList');

  function isPortraitPhone(){
    return window.matchMedia('(max-width: 680px)').matches &&
           window.matchMedia('(orientation: portrait)').matches;
  }
  function isLandscapeOrWide(){
    return window.matchMedia('(orientation: landscape)').matches ||
           window.innerWidth >= 900;
  }

  function layoutTabs(){
    if(!midTabs || !moreWrap || !moreBtn || !moreList) return;

    // Always show all tabs and hide MORE in landscape / wide screens
    if (isLandscapeOrWide()){
      // Put every hidden tab back, hide more
      $$('.tab', midTabs).forEach(b => b.style.display = 'inline-flex');
      moreWrap.classList.remove('open');
      moreBtn.style.display = 'none';
      return;
    }

    // Portrait phones: enable overflow-to-More
    moreList.classList.add('fullscreen');
    moreList.innerHTML = '';
    moreBtn.style.display = 'inline-flex';

    // Measure available width between header edges (minus avatar)
    const leftWidth  = header.children[0]?.offsetWidth || 0;
    const rightWidth = header.children[header.children.length-1]?.offsetWidth || 0;
    const available  = header.clientWidth - leftWidth - rightWidth - 28;

    let used = 0;
    const overflow = [];
    const tabs = $$('.tab', midTabs);

    tabs.forEach(btn => {
      btn.style.display = 'inline-flex';
      const w = btn.offsetWidth + 10;      // include gap
      if (used + w <= available){ used += w; }
      else { overflow.push(btn); }
    });

    if (overflow.length){
      // Hide overflowed tabs, move them into More sheet
      overflow.forEach(btn=>{
        btn.style.display = 'none';
        const item = document.createElement('button');
        item.className = 'more-item';
        item.textContent = btn.textContent.trim();
        item.addEventListener('click', ()=>{ btn.click(); moreWrap.classList.remove('open'); });
        moreList.appendChild(item);
      });
    } else {
      moreBtn.style.display = 'none';
      moreWrap.classList.remove('open');
    }
  }

  // Wire MORE button open/close
  moreBtn?.addEventListener('click', ()=> moreWrap.classList.toggle('open'));
  document.addEventListener('click', (e)=>{ if(moreWrap && !moreWrap.contains(e.target)) moreWrap.classList.remove('open'); });

  // Initial + on resize
  layoutTabs();
  window.addEventListener('resize', () => requestAnimationFrame(layoutTabs));

  /* ---------- 5) Make absolutely sure buttons are tappable (iOS quirks) ---------- */
  $$('.btn, .tab, .more-btn, .more-item, .avatar, a, button').forEach(el=>{
    el.style.touchAction = 'manipulation';
    el.style.cursor = 'pointer';
  });

})();
</script>
<!-- ========= /PATCH ========= -->
</body>
</html>

 